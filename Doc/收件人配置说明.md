# SVN Monitor 收件人管理功能

## 功能说明

本功能允许用户通过Excel文件为不同的SVN仓库配置不同的收件人。当SVN仓库发生变更时，系统将根据Excel中的配置将通知发送给对应的收件人。

## 前提条件

使用此功能需要安装以下Python库：

```bash
pip install pandas openpyxl
```

如果未安装这些库，系统将自动回退到使用配置文件中的默认收件人。

## 配置方法

### 1. 配置文件设置

在 `config/svn_monitor_config.xlsx` 文件中，收件人配置已集成到主配置文件中：

- **全局配置**：在 `Global Configs` 工作表中配置SMTP设置和默认收件人
- **仓库配置**：在 `Repository Configs` 工作表中为每个仓库配置收件人

**Excel文件结构**：

- `Global Configs` 工作表：包含SMTP服务器、端口、认证信息等全局设置
- `Repository Configs` 工作表：包含每个仓库的收件人配置

收件人配置直接集成在仓库配置中，无需单独的收件人Excel文件。

### 2. 配置格式

收件人配置直接集成在主配置文件中：

- **仓库配置**：在 `Repository Configs` 工作表中，每个仓库有专门的 `Recipients` 列
- **收件人格式**：多个收件人之间使用分号（;）分隔

**示例格式：**

| Repository Name | Repository Path | Local Working Copy | Notify On Changes | Recipients |
|-----------------|-----------------|-------------------|-------------------|------------|
| REPO_1 | https://example.com/svn/repo1 | C:\svn_wc\repo1 | True | user1@example.com;user2@example.com |
| REPO_2 | https://example.com/svn/repo2 | C:\svn_wc\repo2 | True | user3@example.com;user4@example.com |

### 3. 创建示例配置文件

可以使用提供的脚本快速创建示例配置文件：

```bash
python src/create_recipients_excel.py
```

运行后，脚本会在 `config` 目录创建 `svn_monitor_config.xlsx` 文件，并显示创建的内容。

## 使用说明

1. 根据实际情况编辑 `config/svn_monitor_config.xlsx` 文件，在 `Repository Configs` 工作表中为每个仓库配置收件人
2. 在 `Global Configs` 工作表中配置SMTP设置和默认收件人
3. 重启SVN Monitor服务，新的收件人配置将生效

## 工作原理

1. 系统启动时，会自动加载Excel文件中的收件人配置
2. 当检测到仓库变更时，系统会：
   - 查找该仓库在Excel中配置的收件人
   - 如果找到，则发送通知给这些收件人
   - 如果未找到，则发送通知给配置文件中的默认收件人
3. 如果有多个仓库同时发生变更，系统会按仓库分别发送邮件通知

## 注意事项

1. 配置文件使用Excel格式，确保使用UTF-8编码以支持中文字符
2. 仓库名称需要与 `Repository Configs` 工作表中的仓库名称完全匹配（区分大小写）
3. 如果不需要为某个仓库单独配置收件人，可以在 `Recipients` 列留空，系统会使用全局配置中的默认收件人
4. 定期检查日志文件，确认收件人配置是否正确加载
5. 确保 `config` 目录存在且配置文件路径正确