# SVN监控系统 - 用户使用手册

## 1. 系统简介

### 1.1 系统概述
SVN监控系统是一个自动化工具，用于监控SVN仓库的提交活动，并在检测到新提交时自动发送邮件通知。

### 1.2 主要功能
- 实时监控多个SVN仓库
- 自动发送邮件通知
- 灵活的配置管理
- 详细的日志记录

### 1.3 适用用户
- 开发团队负责人
- 项目管理人员
- 质量保证人员
- 系统运维人员

## 2. 系统安装

### 2.1 环境要求
**硬件要求**：
- 内存：至少2GB
- 磁盘空间：至少1GB可用空间
- 网络：稳定的网络连接

**软件要求**：
- 操作系统：Windows 10/11 或 Linux Ubuntu 20.04+
- Python版本：3.8或更高版本
- SVN客户端：1.14或更高版本

### 2.2 安装步骤

#### 步骤1：下载系统文件
```bash
# 从代码仓库下载系统文件
git clone <repository-url>
cd svn-monitor
```

#### 步骤2：安装Python依赖
```bash
# 安装必要的Python包
pip install -r requirements.txt
```

#### 步骤3：配置系统环境
```bash
# 检查Python和SVN版本
python --version
svn --version
```

### 2.3 快速启动
```bash
# 进入系统目录
cd d:\B_Code\B_project\snake

# 启动监控系统
python src\svn_monitor.py
```

## 3. 系统配置

### 3.1 配置文件说明
系统使用Excel文件进行配置管理，配置文件位于：`config/svn_monitor_config.xlsx`

#### 配置文件结构
```
配置文件包含以下工作表：
1. 仓库配置：SVN仓库信息
2. 邮件配置：邮件服务器设置
3. 收件人配置：邮件收件人列表
4. 系统配置：系统运行参数
```

### 3.2 仓库配置

#### 配置项说明
| 字段名 | 说明 | 示例 | 必填 |
|--------|------|------|------|
| 仓库名称 | SVN仓库的标识名称 | 主项目仓库 | 是 |
| 仓库路径 | SVN仓库的URL路径 | http://svn.example.com/repo | 是 |
| 监控状态 | 是否启用监控 | 启用/禁用 | 是 |
| 检查间隔 | 监控检查间隔（秒） | 30 | 是 |

#### 配置示例
```
仓库名称,仓库路径,监控状态,检查间隔
主项目仓库,http://svn.example.com/main,启用,30
测试仓库,http://svn.example.com/test,启用,60
备份仓库,http://svn.example.com/backup,禁用,30
```

### 3.3 邮件配置

#### 配置项说明
| 字段名 | 说明 | 示例 | 必填 |
|--------|------|------|------|
| 邮件服务器 | SMTP服务器地址 | smtp.example.com | 是 |
| 端口 | SMTP服务器端口 | 587 | 是 |
| 用户名 | 发件人邮箱用户名 | monitor@example.com | 是 |
| 密码 | 发件人邮箱密码 | ******** | 是 |
| 加密方式 | 连接加密方式 | TLS/SSL | 是 |

### 3.4 收件人配置

#### 配置项说明
| 字段名 | 说明 | 示例 | 必填 |
|--------|------|------|------|
| 仓库名称 | 对应的SVN仓库 | 主项目仓库 | 是 |
| 收件人邮箱 | 邮件接收地址 | user@example.com | 是 |
| 收件人姓名 | 收件人显示名称 | 张三 | 否 |
| 通知类型 | 接收的通知类型 | 全部/仅错误 | 是 |

## 4. 操作指南

### 4.1 启动监控系统

#### 方式一：命令行启动
```bash
# 进入系统目录
cd d:\B_Code\B_project\snake

# 启动监控系统
python src\svn_monitor.py
```

#### 方式二：批处理文件启动
```bash
# 使用批处理文件启动
scripts\run_svn_monitor.bat
```

#### 方式三：SVN钩子启动
```bash
# 配置SVN钩子后自动触发
# 钩子脚本位置：scripts\post-commit
```

### 4.2 停止监控系统

#### 正常停止
```bash
# 在命令行中按 Ctrl+C 停止系统
```

#### 强制停止
```bash
# 在任务管理器中结束Python进程
```

### 4.3 查看监控状态

#### 检查运行状态
```bash
# 查看系统进程
ps aux | grep svn_monitor
```

#### 查看监控统计
系统会定期输出监控统计信息：
```
[STAT] 监控周期：30秒
[STAT] 已检查次数：50
[STAT] 检测到提交：10次
[STAT] 发送邮件：10封
[STAT] 成功率：100%
```

### 4.4 查看监控日志

#### 检查日志文件
```bash
# 查看最新日志
tail -f logs\svn_monitor.log
```

#### 日志文件位置
- 主日志文件：`logs/svn_monitor.log`
- 错误日志文件：`logs/error.log`
- 邮件发送日志：`logs/mail.log`

## 5. 部署指南

### 5.1 常规部署

#### 5.1.1 Windows环境部署

**环境要求**
- Python 3.7+
- Git客户端
- SVN客户端
- 邮件服务器访问权限

**部署步骤**
1. **环境准备**
   - 安装Python 3.7+并配置环境变量
   - 安装Git客户端
   - 安装SVN客户端并配置命令行工具
   - 确保网络连接正常

2. **脚本部署**
   - 将项目文件复制到目标目录
   - 安装依赖包：`pip install -r requirements.txt`
   - 配置环境变量（如需要）

3. **自动启动配置**
   - 创建Windows服务或计划任务
   - 配置开机自启动
   - 设置监控间隔和重试机制

#### 5.1.2 Linux环境部署

**环境要求**
- Python 3.7+
- Git客户端
- SVN客户端
- 邮件服务器访问权限

**部署步骤**
1. **环境准备**
   - 安装Python 3.7+：`sudo apt-get install python3 python3-pip`
   - 安装Git：`sudo apt-get install git`
   - 安装SVN：`sudo apt-get install subversion`

2. **脚本部署**
   - 将项目文件复制到目标目录
   - 安装依赖包：`pip3 install -r requirements.txt`
   - 设置文件权限：`chmod +x *.py`

3. **自动启动配置**
   - 创建systemd服务文件
   - 配置开机自启动：`sudo systemctl enable svn-monitor`
   - 设置监控间隔和重试机制

### 5.2 SVN钩子部署

#### 5.2.1 Windows环境钩子部署

**钩子创建步骤**
1. **定位SVN仓库**
   - 找到SVN仓库的hooks目录
   - 通常位于：`仓库路径/hooks/`

2. **创建钩子脚本**
   - 复制`post-commit.tmpl`为`post-commit`
   - 编辑钩子脚本，添加监控调用
   - 设置脚本执行权限

3. **权限配置**
   - 确保钩子脚本有执行权限
   - 配置SVN用户权限
   - 测试钩子功能

#### 5.2.2 Linux环境钩子部署

**钩子创建步骤**
1. **定位SVN仓库**
   - 找到SVN仓库的hooks目录
   - 通常位于：`/var/svn/仓库名/hooks/`

2. **创建钩子脚本**
   - 复制`post-commit.tmpl`为`post-commit`
   - 编辑钩子脚本，添加监控调用
   - 设置脚本执行权限：`chmod +x post-commit`

3. **权限配置**
   - 确保钩子脚本有执行权限
   - 配置SVN用户权限
   - 测试钩子功能

### 5.3 配置说明

#### 5.3.1 配置文件结构
- `svn_monitor_config.xlsx`：主配置文件（Excel格式）
- `recipients.xlsx`：收件人配置
- 日志配置在主配置文件的Global Configs工作表中配置

#### 5.3.2 配置参数详解
- **监控间隔**：设置监控频率
- **重试次数**：网络异常时的重试机制
- **邮件模板**：通知邮件的格式和内容
- **日志级别**：系统日志的详细程度

### 5.4 故障排除

#### 5.4.1 常见问题
- **钩子不执行**：检查权限和路径
- **邮件发送失败**：检查网络和配置
- **监控中断**：检查日志和网络连接

#### 5.4.2 解决方案
- 查看详细日志信息
- 检查配置文件格式
- 验证网络连接
- 重启监控服务

## 6. 日常使用

### 6.1 日常监控

#### 查看当前监控状态
系统启动后，控制台会显示当前的监控状态：
```
[INFO] 开始监控SVN仓库...
[INFO] 监控仓库：主项目仓库 (http://svn.example.com/main)
[INFO] 上次检查时间：2024-01-15 10:30:00
[INFO] 当前版本号：1234
```

#### 查看监控统计
系统会定期输出监控统计信息：
```
[STAT] 监控周期：30秒
[STAT] 已检查次数：50
[STAT] 检测到提交：10次
[STAT] 发送邮件：10封
[STAT] 成功率：100%
```

### 6.2 邮件通知管理

#### 邮件内容格式
系统发送的邮件包含以下信息：
- 提交仓库名称
- 提交版本号
- 提交作者
- 提交时间
- 提交日志信息
- 变更文件列表

#### 邮件示例
```
主题：[SVN监控] 主项目仓库有新提交 (版本1234)

内容：
仓库：主项目仓库
版本：1234
作者：张三
时间：2024-01-15 10:30:00
日志：修复用户登录bug

变更文件：
- /src/login.py
- /test/test_login.py
```

### 6.3 配置更新

#### 配置更新方式
1. **修改配置文件**：直接编辑Excel配置文件
2. **重启服务**：修改配置后重启监控服务
3. **热重载**：部分配置支持热重载（开发中）

## 7. 问题排查

### 7.1 常见问题

#### 常见问题及解决方法

**问题1：系统无法启动**
- 检查Python是否安装正确
- 检查依赖包是否安装完整
- 查看错误日志获取详细信息

**问题2：监控不到SVN提交**
- 检查SVN仓库路径是否正确
- 验证网络连接是否正常
- 检查SVN访问权限

**问题3：邮件发送失败**
- 检查邮件服务器配置
- 验证发件人邮箱密码
- 检查网络连接和防火墙设置

**问题4：配置文件读取错误**
- 检查配置文件路径是否正确
- 验证Excel文件格式
- 检查文件权限设置

### 7.2 故障诊断

#### 诊断步骤
1. 查看系统日志
2. 检查网络连接
3. 验证配置参数
4. 测试邮件发送功能

### 7.3 日志分析

#### 日志文件位置
- 主日志文件：`svn_monitor.log`（位于项目根目录）

#### 日志轮转配置
系统支持日志轮转，默认配置：
- 单个日志文件最大：10MB
- 保留日志文件数：5个
- 日志级别：INFO

## 8. 系统维护

### 8.1 定期维护

#### 维护任务
- 定期清理日志文件
- 检查磁盘空间使用
- 更新系统依赖包
- 备份配置文件

### 8.2 备份策略

#### 自动备份
系统会自动备份重要数据：
- 配置文件备份：`backups/config/`
- 日志文件备份：`backups/logs/`
- 数据库备份：`backups/db/`

#### 手动备份
```bash
# 手动执行备份
python scripts\backup.py
```

### 8.3 性能优化

#### 监控指标
- CPU使用率
- 内存使用情况
- 网络连接状态
- 磁盘空间使用

#### 性能优化建议
- 定期清理日志文件
- 优化监控间隔设置
- 调整邮件发送频率

## 9. 附录

### 9.1 收件人配置说明

#### 9.1.1 收件人Excel文件格式

收件人配置使用Excel文件管理，文件格式如下：

| 字段名 | 数据类型 | 必填 | 说明 |
|--------|----------|------|------|
| 姓名 | 字符串 | 是 | 收件人姓名 |
| 邮箱 | 字符串 | 是 | 收件人邮箱地址 |
| 部门 | 字符串 | 否 | 收件人所在部门 |
| 角色 | 字符串 | 否 | 收件人角色（开发/测试/管理等） |
| 通知类型 | 字符串 | 是 | 接收的通知类型（全部/仅错误） |

#### 9.1.2 配置示例

示例收件人配置：

| 姓名 | 邮箱 | 部门 | 角色 | 通知类型 |
|------|------|------|------|----------|
| 张三 | zhangsan@company.com | 开发部 | 开发 | 全部 |
| 李四 | lisi@company.com | 测试部 | 测试 | 仅错误 |
| 王五 | wangwu@company.com | 管理部 | 管理 | 全部 |

#### 9.1.3 配置更新

1. **添加收件人**：在Excel文件中新增行
2. **修改收件人**：编辑对应行的信息
3. **删除收件人**：删除对应行
4. **重新加载配置**：重启监控服务或发送重载信号

### 9.2 术语表

### 9.3 参考文档
- 详细设计文档：`Doc/detailed_design.md`
- 部署指南：`Doc/DEPLOYMENT_GUIDE.md`
- 问题记录：`Doc/TESTING_AND_ISSUES.md`

### 9.4 联系方式

#### 技术支持信息
- 系统管理员：admin@example.com
- 开发团队：dev@example.com
- 紧急联系电话：+86-138-xxxx-xxxx

#### 问题报告格式
报告问题时请提供以下信息：
- 系统版本号
- 错误发生时间
- 错误日志内容
- 系统环境信息

#### 常用命令
```bash
# 查看系统版本
python src\svn_monitor.py --version

# 测试配置
python src\svn_monitor.py --test-config

# 查看帮助信息
python src\svn_monitor.py --help
```

#### 配置文件示例
完整的配置文件示例请参考：`config/svn_monitor_config.example.xlsx`

---
*本文档为SVN监控系统的用户使用手册，如有问题请参考相关文档或联系技术支持。*